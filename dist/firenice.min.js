!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);class s{constructor(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.action=!1,this.keydown=this.keydown_.bind(this),this.keyup=this.keyup_.bind(this),this.intro=!0,window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),document.getElementById("canvas").addEventListener("click",()=>{this.intro&&(this.enter=!0),this.intro=!1}),document.getElementById("btn_action").addEventListener("pointerdown",()=>this.down=!0),document.getElementById("btn_action").addEventListener("pointerup",()=>this.down=!1),document.getElementById("btn_left").addEventListener("pointerdown",()=>this.left=!0),document.getElementById("btn_left").addEventListener("pointerup",()=>this.left=!1),document.getElementById("btn_right").addEventListener("pointerdown",()=>this.right=!0),document.getElementById("btn_right").addEventListener("pointerup",()=>this.right=!1),document.getElementById("btn_select").addEventListener("pointerup",()=>this.enter=!0)}keydown_(t){switch(t.keyCode){case 37:this.left=!0;break;case 38:this.up=!0;break;case 39:this.right=!0;break;case 40:case 32:this.action=!0,this.down=!0;break;case 13:this.enter=!1}}keyup_(t){switch(t.keyCode){case 37:this.left=!1;break;case 38:this.up=!1;break;case 39:this.right=!1;break;case 40:case 32:this.action=!1,this.down=!1;break;case 13:this.enter=!0}}}class h{constructor(){this.musicOn=!0,this.soundOn=!0,this.sfxVolume=.3,this.sfx={"fire-off":document.getElementById("sfx-fire-off"),"ice-push":document.getElementById("sfx-ice-push"),fall:document.getElementById("sfx-fall"),falling:document.getElementById("sfx-falling"),"new-ice":document.getElementById("sfx-new-ice"),climb:document.getElementById("sfx-climb"),"ice-collision":document.getElementById("sfx-ice-collision"),"stage-enter":document.getElementById("sfx-stage-enter"),danger:document.getElementById("sfx-danger"),"ice-remove":document.getElementById("sfx-ice-remove"),"state-leave":document.getElementById("sfx-state-leave"),"ice-disabled":document.getElementById("sfx-disabled")}}play(t){this.soundOn&&(this.sfx[t].volume=this.sfxVolume,this.sfx[t].currentTime=0,this.sfx[t].play().catch(()=>{}))}playOnce(t){this.sfx[t].paused&&this.soundOn&&(this.sfx[t].volume=this.sfxVolume,this.sfx[t].currentTime=0,this.sfx[t].play().catch(()=>{}))}stop(t){this.sfx[t].pause(),this.sfx[t].currentTime=0}soundrack(){this.musicOn&&(this.music=document.getElementById("sfx-music-sparks"),this.music.muted=!1,this.music.volume=.2,this.music.loop=!0,this.music.play().catch(()=>{}))}}const n={TILE_WIDTH:32,MOVE_STAND:0,MOVE_LEFT:1,MOVE_RIGHT:2,MOVE_DOWN:3,MOVE_UP:4,MOVE_TURN:5,MOVE_ICE_MAKE:6,MOVE_ICE_REMOVE:7,MOVE_ICE_MOVING:8,MOVE_ICE_CHECK:9,MOVE_RIP:10,MOVE_PUSH:8,MOVE_ICE_FAIL:11,MOVE_OUTRO:12,MOVE_INTRO:13,DIR_LEFT:-1,DIR_RIGHT:1,ANIM_STANDARD_DELAY:2,ANIM_FRAME_COUNT:16,ANIM_LEFT_ROW:1,ANIM_RIGHT_ROW:0,ANIM_RUN_START:0,ANIM_RUN_END:3,ANIM_STAND:4,ANIM_TURN_START:4,ANIM_TURN_END:7,ANIM_FALL_START:8,ANIM_FALL_END:9,ANIM_BIG_FALL_START:10,ANIM_BIG_FALL_END:11,ANIM_PUSH_START:12,ANIM_PUSH_END:13,ANIM_JUMP_START:14,ANIM_JUMP_END:15,ANIM_STAND_START:16,ANIM_STAND_END:17,ANIM_ICE_START:18,ANIM_ICE_END:19,ANIM_CROUCH_START:20,ANIM_CROUCH_END:22,ANIM_RIP_START:23,ANIM_RIP_END:24,ANIM_SLEEP_START:25,ANIM_SLEEP_END:26,TILE_BACKGROUND:0,TILE_BOTH:32,TILE_LEFT:64,TILE_MIDDLE:96,TILE_RIGHT:128,OBJECT_OUT:-1,OBJECT_BACKGROUND:0,OBJECT_WALL:1,OBJECT_ICE:3,OBJECT_METAL:4,OBJECT_JAR:5,OBJECT_FIRE:6,OBJECT_PLAYER:7,GAME_STATE_PLAY:1,GAME_STATE_INTRO:2};class r{constructor(t,i,e){this.ctx=t.ctx,this.engine=t,this.map=i,this.theme=e,this.tileWidth=n.TileWidth,this.tileHeight=n.TileWidth,this.height=this.map.length-1,this.width=this.map[0].length-1,this.tilesImage=this.engine.resources.get("tilemap")}getTile(t,i){return t<0||i<0||t>this.width||i>this.height?n.OBJECT_OUT:this.map[i][t]}draw(){this.ctx.save();for(let t=0;t<=this.width;++t)for(let i=0;i<=this.height;++i){let e=n.TILE_BACKGROUND;1===this.map[i][t]&&(e=this.getTile(t-1,i)||this.getTile(t+1,i)?this.getTile(t-1,i)?this.getTile(t+1,i)?n.TILE_MIDDLE:n.TILE_RIGHT:n.TILE_LEFT:n.TILE_BOTH),this.ctx.drawImage(this.tilesImage,e,this.theme*this.tileHeight,this.tileWidth,this.tileHeight,t*this.tileWidth,i*this.tileHeight,this.tileWidth,this.tileHeight)}this.ctx.restore()}move(){}engineMove(){}}class o{constructor(){this.u=0,this.d=0,this.l=0,this.r=0,this.ul=0,this.ur=0,this.dl=0,this.dr=0}}class d{constructor(t,i,e,s,h,r){this.engine=i,this.id=t,this.ctx=i.ctx,this.coorners=new o,this.solid=!0,this.moving=!1,this.counter=!1,this.speed=4,this.state=n.MOVE_STAND,this.height=r,this.width=h,this.dirrection=0,this.xtile=e,this.ytile=s,this.x=this.xtile*n.TILE_WIDTH,this.y=this.ytile*n.TILE_WIDTH}setState(t,i){this.moving=void 0!==i&&i,this.state=t,this.counter=0}getTile(t,i){return this.engine.map.getTile(t,i)}isSpriteAt(t,i){return this.xtile===t&&this.ytile===i}spriteTypeAt(t,i){return this.engine.spriteTypeAt(t,i)}move(){}engineMove(){this.coorners.u=this.spriteTypeAt(this.xtile,this.ytile-1),this.coorners.d=this.spriteTypeAt(this.xtile,this.ytile+1),this.coorners.l=this.spriteTypeAt(this.xtile-1,this.ytile),this.coorners.r=this.spriteTypeAt(this.xtile+1,this.ytile),this.coorners.ul=this.spriteTypeAt(this.xtile-1,this.ytile-1),this.coorners.ur=this.spriteTypeAt(this.xtile+1,this.ytile-1),this.coorners.dl=this.spriteTypeAt(this.xtile-1,this.ytile+1),this.coorners.dr=this.spriteTypeAt(this.xtile+1,this.ytile+1),this.move(),this.xtile=Math.floor(this.x/n.TILE_WIDTH),this.ytile=Math.floor(this.y/n.TILE_WIDTH)}}class l extends d{constructor(t,i,e,s,h,r,o,d,l,a,_,c){super(t,i,s,h,r,o),this.image=this.engine.resources.get(e),this.animLoop=c,this.animStart=a,this.animEnd=_,this.animCount=0,this.animDelay=n.ANIM_STANDARD_DELAY,this.animDelayCount=0,this.animRow=0,this.offsetX=d,this.offsetY=l}setAnim(t,i,e,s,h,r){let o=void 0!==r&&r,d=void 0===h?n.ANIM_STANDARD_DELAY:h,l=void 0===s?this.animRow:s;o&&this.animStart===t&&this.animEnd===i&&this.animLoop===e&&this.animRow===l||(this.animStart=t,this.animEnd=i,this.animCount=t,this.animLoop=e,this.animDelay=d,this.animRow=l)}draw(){this.ctx.save(),this.ctx.drawImage(this.image,this.animCount*this.width,this.animRow*this.height,this.width,this.height,this.x+this.offsetX,this.y+this.offsetY,this.width,this.height),this.animDelayCount++>this.animDelay&&(++this.animCount>this.animEnd&&(this.animLoop?this.animCount=this.animStart:this.animCount=this.animEnd),this.animDelayCount=0),this.ctx.restore()}}const a={tiles:{[n.OBJECT_BACKGROUND]:{solid:!1},[n.OBJECT_OUT]:{solid:!0},[n.OBJECT_PLAYER]:{solid:!0},[n.OBJECT_ICE]:{solid:!0},[n.OBJECT_METAL]:{solid:!0},[n.OBJECT_WALL]:{solid:!0},[n.OBJECT_FIRE]:{solid:!1},[n.OBJECT_JAR]:{solid:!0}},isSolid:function(t){if(void 0===this.tiles[t])throw new Error("UNDEFINED ON isSolid");return this.tiles[t].solid}};class _ extends l{constructor(t,i,e){super(n.OBJECT_PLAYER,t,"img_dona",i,e,48,64,-10,-32,2,2,!1),this.speed=2,this.dirrection=1,this.state=0,this.moving=!1,this.tileWidth=n.TILE_WIDTH,this.tileHeight=n.TILE_WIDTH,this.animDelay=3,this.counter=0,this.fallCounter=0,this.innerCounter=0,this.standCounter=0,this.intro()}left(){this.moving||(this.dirrection!==n.DIR_LEFT?(a.isSolid(this.coorners.u)?this.setAnim(n.ANIM_CROUCH_START,n.ANIM_CROUCH_START,!1,n.ANIM_LEFT_ROW,4):this.setAnim(n.ANIM_TURN_START,n.ANIM_TURN_END,!1,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_TURN,!0),this.dirrection=n.DIR_LEFT):(!a.isSolid(this.coorners.l)&&a.isSolid(this.coorners.d)&&(a.isSolid(this.coorners.u)||a.isSolid(this.coorners.ul)?this.setAnim(n.ANIM_CROUCH_START,n.ANIM_CROUCH_END,!1,n.ANIM_LEFT_ROW):this.setAnim(n.ANIM_RUN_START,n.ANIM_RUN_END,!1,n.ANIM_LEFT_ROW),this.setState(n.MOVE_LEFT,!0)),!a.isSolid(this.coorners.d)||this.coorners.l!==n.OBJECT_ICE&&this.coorners.l!==n.OBJECT_METAL||this.push(),!a.isSolid(this.coorners.l)||!a.isSolid(this.coorners.d)||a.isSolid(this.coorners.u)||a.isSolid(this.coorners.ul)||this.moving||(this.setAnim(n.ANIM_PUSH_START,n.ANIM_PUSH_START,!1,n.ANIM_LEFT_ROW),this.setState(n.MOVE_UP,!0))))}right(){this.moving||(this.dirrection!==n.DIR_RIGHT?(a.isSolid(this.coorners.u)?this.setAnim(n.ANIM_CROUCH_START,n.ANIM_CROUCH_START,!1,n.ANIM_RIGHT_ROW,4):this.setAnim(n.ANIM_TURN_START,n.ANIM_TURN_END,!1,n.ANIM_LEFT_ROW,4),this.setState(n.MOVE_TURN,!0),this.dirrection=n.DIR_RIGHT):(!a.isSolid(this.coorners.r)&&a.isSolid(this.coorners.d)&&(a.isSolid(this.coorners.u)||a.isSolid(this.coorners.ur)?this.setAnim(n.ANIM_CROUCH_START,n.ANIM_CROUCH_END,!1,n.ANIM_RIGHT_ROW):this.setAnim(n.ANIM_RUN_START,n.ANIM_RUN_END,!1,n.ANIM_RIGHT_ROW),this.setState(n.MOVE_RIGHT,!0)),!a.isSolid(this.coorners.d)||this.coorners.r!==n.OBJECT_ICE&&this.coorners.r!==n.OBJECT_METAL||this.push(),!a.isSolid(this.coorners.r)||!a.isSolid(this.coorners.d)||a.isSolid(this.coorners.u)||a.isSolid(this.coorners.ur)||this.moving||(this.setAnim(n.ANIM_PUSH_START,n.ANIM_PUSH_START,!1,n.ANIM_RIGHT_ROW),this.setState(n.MOVE_UP,!0))))}burn(){this.state!==n.MOVE_RIP&&(this.engine.sound.playOnce("danger"),this.setState(n.MOVE_RIP,!0),this.setAnim(n.ANIM_RIP_START,n.ANIM_RIP_END,!0,n.ANIM_RIGHT_ROW))}intro(){this.setAnim(n.ANIM_BIG_FALL_START,n.ANIM_BIG_FALL_END,!0,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_INTRO,!0),this.y-=32}outro(){this.setAnim(n.ANIM_FALL_START,n.ANIM_BIG_FALL_END,!0,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_OUTRO,!0),this.innerCounter=0}doRip(){}gravity(){if(!this.moving)if(void 0===this.coorners.d&&console.eror("undefined coorner"),a.isSolid(this.coorners.d)){if(this.engine.sound.stop("falling"),this.state===n.MOVE_DOWN&&(this.engine.sound.play("fall"),this.fallCounter>=2&&(this.engine.addSparks(this.xtile,this.ytile+1,"255, 135, 124",5,.75),this.engine.addSparks(this.xtile,this.ytile+1,"122, 211, 255",10,1))),this.fallCounter=0,this.setState(n.MOVE_STAND,!1),this.coorners.d===n.OBJECT_JAR){const t=this.engine.spriteAt(this.xtile,this.ytile+1);t&&t.onFire&&this.burn()}}else this.setState(n.MOVE_DOWN,!0),this.fallCounter>=1&&this.engine.sound.playOnce("falling"),this.fallCounter,this.setAnim(n.ANIM_BIG_FALL_START,n.ANIM_BIG_FALL_END,!0,n.ANIM_RIGHT_ROW)}ice(){this.moving||a.isSolid(this.coorners.d)&&(this.dirrection===n.DIR_RIGHT?a.isSolid(this.coorners.dr)||this.coorners.dr===n.OBJECT_FIRE?this.coorners.dr===n.OBJECT_ICE?(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_ICE_REMOVE,!0)):(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_ICE_FAIL,!0)):(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_RIGHT_ROW,4),this.setState(n.MOVE_ICE_MAKE,!0)):a.isSolid(this.coorners.dl)||this.coorners.dl===n.OBJECT_FIRE?this.coorners.dl===n.OBJECT_ICE?(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_LEFT_ROW,4),this.setState(n.MOVE_ICE_REMOVE,!0)):(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_LEFT_ROW,4),this.setState(n.MOVE_ICE_FAIL,!0)):(this.setAnim(n.ANIM_ICE_START,n.ANIM_ICE_END,!1,n.ANIM_LEFT_ROW,4),this.setState(n.MOVE_ICE_MAKE,!0)))}jump(){this.moving||(this.dirrection===n.DIR_RIGHT?!a.isSolid(this.coorners.r)||a.isSolid(this.coorners.ur)||a.isSolid(this.coorners.u)||(this.setAnim(n.ANIM_PUSH_START,n.ANIM_PUSH_START,!1,n.ANIM_RIGHT_ROW),this.setState(n.MOVE_UP,!0)):!a.isSolid(this.coorners.l)||a.isSolid(this.coorners.ul)||a.isSolid(this.coorners.u)||(this.setAnim(n.ANIM_PUSH_START,n.ANIM_PUSH_START,!1,n.ANIM_LEFT_ROW),this.setState(n.MOVE_UP,!0)))}doRun(){this.counter++,this.counter<=n.ANIM_FRAME_COUNT?this.x+=this.speed*this.dirrection:this.setState(n.MOVE_STAND,!1)}doTurn(){this.counter++,this.counter>=n.ANIM_FRAME_COUNT&&this.setState(n.MOVE_STAND,!1)}doOutro(){this.counter+=1,this.counter%10==0&&(this.innerCounter+=1,1===this.innerCounter&&this.engine.addSparks(this.xtile,this.ytile,"124, 238, 66",20,.5),3===this.innerCounter&&this.engine.addSparks(this.xtile,this.ytile,"255, 135, 124",15,1),5===this.innerCounter&&this.engine.addSparks(this.xtile,this.ytile,"122, 211, 255",10,1.5),this.innerCounter%2==0&&this.innerCounter<6&&this.engine.sound.play("climb")),this.innerCounter%2==1?this.y+=1:this.y-=1,this.innerCounter>=6&&(this.engine.sound.play("state-leave"),this.setState(n.MOVE_STAND,!1),this.engine.nextLevel())}doIntro(){this.counter+=1,4===this.counter&&(this.engine.addSparks(this.xtile,this.ytile,"124, 238, 66",20,.5),this.engine.addSparks(this.xtile,this.ytile,"255, 135, 124",15,1),this.engine.addSparks(this.xtile,this.ytile,"122, 211, 255",10,1.5),this.engine.sound.play("stage-enter")),this.counter<=16?this.y+=2:(this.engine.sound.stop("falling"),this.setState(n.MOVE_STAND,!1))}doGravity(){this.counter+=1,this.counter<=n.ANIM_FRAME_COUNT?this.y+=this.speed:(this.moving=!1,this.gravity(),this.fallCounter++)}doStand(){a.isSolid(this.coorners.u)?this.setAnim(n.ANIM_CROUCH_START,n.ANIM_CROUCH_START,!1,1!==this.dirrection?n.ANIM_LEFT_ROW:n.ANIM_RIGHT_ROW,8,!0):this.standCounter++>500?this.setAnim(n.ANIM_SLEEP_START,n.ANIM_SLEEP_END,!0,1!==this.dirrection?n.ANIM_LEFT_ROW:n.ANIM_RIGHT_ROW,48,!0):this.setAnim(n.ANIM_STAND_START,n.ANIM_STAND_END,!0,1!==this.dirrection?n.ANIM_LEFT_ROW:n.ANIM_RIGHT_ROW,8,!0)}doUp(){if(this.counter+=1,this.counter<=18)switch(this.counter){case 3:this.engine.sound.play("climb"),this.engine.addSparks(this.xtile,this.ytile,"124, 238, 66",10,.75),this.engine.addSparks(this.xtile,this.ytile,"255, 135, 124",5,1.25),this.setAnim(n.ANIM_PUSH_END,n.ANIM_PUSH_END,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW);break;case 6:this.setAnim(n.ANIM_JUMP_START,n.ANIM_JUMP_START,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW),this.x+=8*this.dirrection,this.y-=8;break;case 9:this.setAnim(n.ANIM_JUMP_END,n.ANIM_JUMP_END,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW),this.x+=8*this.dirrection,this.y-=8;break;case 12:this.setAnim(2,2,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW),this.x+=8*this.dirrection,this.y-=8;break;case 18:this.setAnim(n.ANIM_STAND,n.ANIM_STAND,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW),this.x+=8*this.dirrection,this.y-=8}else this.setState(n.MOVE_STAND,!1)}makeIce(){this.engine.sound.play("new-ice"),this.engine.addIceBlock(this.xtile+this.dirrection,this.ytile+1),this.engine.addSparks(this.xtile+this.dirrection,this.ytile+1),this.engine.addSparks(this.xtile+this.dirrection,this.ytile+1,"124, 214, 255",5)}removeIceBlock(){this.engine.sound.play("ice-remove"),this.engine.removeIceBlock(this.xtile+this.dirrection,this.ytile+1),this.engine.addSparks(this.xtile+this.dirrection,this.ytile+1),this.engine.addSparks(this.xtile+this.dirrection,this.ytile+1,"124, 214, 255",5)}push(){let t=this.engine.iceAt(this.xtile+this.dirrection,this.ytile);t&&t.canGlide(this.dirrection)&&(this.engine.addSparks(this.xtile+this.dirrection,this.ytile,"255, 255, 255",3),this.engine.addSparks(this.xtile+this.dirrection,this.ytile,"124, 214, 255",3,1.5),this.setAnim(n.ANIM_PUSH_START,n.ANIM_PUSH_END,!1,this.dirrection===n.DIR_RIGHT?n.ANIM_RIGHT_ROW:n.ANIM_LEFT_ROW,3),this.setState(n.MOVE_PUSH,!0))}doPush(){if(this.counter+=2,this.counter<=n.ANIM_FRAME_COUNT);else{let t=this.engine.iceAt(this.xtile+this.dirrection,this.ytile);t&&(this.engine.sound.play("ice-push"),t.push(this.dirrection)),this.setState(n.MOVE_STAND,!1)}}doIce(){8===this.counter&&(this.state===n.MOVE_ICE_MAKE?this.makeIce():this.removeIceBlock()),this.counter+=1,this.counter>=n.ANIM_FRAME_COUNT&&this.setState(n.MOVE_STAND,!1)}doFailIce(){8===this.counter&&(this.engine.sound.play("ice-disabled"),this.engine.addSparks(this.xtile+this.dirrection,this.ytile+1,"88,66,66")),this.counter+=1,this.counter>=n.ANIM_FRAME_COUNT&&this.setState(n.MOVE_STAND,!1)}collisions(){this.engine.spriteTypeAt(this.xtile,this.ytile,n.OBJECT_PLAYER)===n.OBJECT_FIRE&&this.burn()}move(){switch(this.gravity(),this.collisions(),this.state!==n.MOVE_STAND&&(this.standCounter=0),this.state!==n.MOVE_DOWN&&(this.fallCounter=0),this.state){case n.MOVE_RIGHT:case n.MOVE_LEFT:this.doRun();break;case n.MOVE_DOWN:this.doGravity();break;case n.MOVE_UP:this.doUp();break;case n.MOVE_TURN:this.doTurn();break;case n.MOVE_ICE_MAKE:case n.MOVE_ICE_REMOVE:this.doIce();break;case n.MOVE_ICE_FAIL:this.doFailIce();break;case n.MOVE_STAND:this.doStand();break;case n.MOVE_PUSH:this.doPush();break;case n.MOVE_RIP:this.doRip();break;case n.MOVE_OUTRO:this.doOutro();break;case n.MOVE_INTRO:this.doIntro()}}}class c extends l{constructor(t,i,e,s,h){super(n.OBJECT_ICE,t,"img_ice",i,e,n.TILE_WIDTH,n.TILE_WIDTH,0,0,0,1,!0),this.xtile=i,this.ytile=e,this.frozen=void 0!==h&&h,this.length=s,this.animEnd=1,this.animDelay=9,this.animRow=0,this.dirrection=0,this.falling=!1,this.checkFreeze()}addBlock(t){const i=this.engine.spriteTypeAt(this.xtile-1,this.ytile),e=this.engine.spriteTypeAt(this.xtile+this.length,this.ytile);(t>this.xtile&&this.getTile(t+1,this.ytile)===n.OBJECT_WALL||t<this.xtile&&this.getTile(t-1,this.ytile)===n.OBJECT_WALL||i===n.OBJECT_METAL||i===n.OBJECT_JAR||e===n.OBJECT_METAL||e===n.OBJECT_JAR)&&(this.frozen=!0),this.xtile=t<this.xtile?t:this.xtile,this.x=this.xtile*n.TILE_WIDTH,this.length++}isSpriteAt(t,i){return this.ytile===i&&(t>=this.xtile&&t<this.xtile+this.length)}removeBlock(t){return t===this.xtile?(this.xtile+=1,this.x+=n.TILE_WIDTH,this.length--):t===this.xtile+this.length-1?this.length--:(this.engine.addSprite(new c(this.engine,t+1,this.ytile,this.xtile+this.length-t-1)),this.length=t-this.xtile),this.length}canGlide(t){return 1===this.length&&!this.frozen&&((t!==n.DIR_LEFT||!a.isSolid(this.coorners.l))&&(t!==n.DIR_RIGHT||!a.isSolid(this.coorners.r)))}gravity(){return this.coorners.d||this.frozen?(this.falling&&(this.falling=!1,this.engine.sound.play("ice-collision")),!1):(this.falling=!0,this.setState(n.MOVE_DOWN,!0),!0)}collision(){return!this.canGlide(this.dirrection)&&(this.dirrection=0,this.engine.sound.play("ice-collision"),!0)}move(){for(let t=0;t<this.length;t++){let i=this.spriteTypeAt(this.xtile+t,this.ytile+1);i&&i!==n.OBJECT_FIRE&&(this.coorners.d=i)}switch(this.coorners.d===n.OBJECT_FIRE&&(this.coorners.d=n.OBJECT_BACKGROUND),this.coorners.r=this.spriteTypeAt(this.xtile+this.length,this.ytile),this.frozen&&this.checkUnfreeze(),this.moving||this.gravity(),this.state){case n.MOVE_ICE_MOVING:this.glide();break;case n.MOVE_ICE_CHECK:this.push();break;case n.MOVE_DOWN:this.doDown()}}draw(){const t=this.engine.spriteTypeAt(this.xtile-1,this.ytile),i=this.engine.spriteTypeAt(this.xtile+this.length,this.ytile);if(this.ctx.save(),this.animDelayCount++>this.animDelay&&(this.animDelayCount=0,this.animRow=0===this.animRow?1:0),1===this.length)this.ctx.drawImage(this.image,0,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x,this.y,this.width,this.height);else if(2===this.length)this.ctx.drawImage(this.image,1*n.TILE_WIDTH,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x,this.y,this.width,this.height),this.ctx.drawImage(this.image,3*n.TILE_WIDTH,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x+n.TILE_WIDTH,this.y,this.width,this.height);else{this.ctx.drawImage(this.image,1*n.TILE_WIDTH,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x,this.y,this.width,this.height),this.ctx.drawImage(this.image,3*n.TILE_WIDTH,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x+n.TILE_WIDTH*(this.length-1),this.y,this.width,this.height);for(let t=1;t<this.length-1;t++)this.ctx.drawImage(this.image,2*n.TILE_WIDTH,n.TILE_WIDTH*this.animRow,this.width,this.height,this.x+n.TILE_WIDTH*t,this.y,this.width,this.height)}this.frozen&&(this.getTile(this.xtile-1,this.ytile)!==n.OBJECT_WALL&&t!==n.OBJECT_METAL&&t!==n.OBJECT_JAR||this.ctx.drawImage(this.engine.resources.get("frost"),this.xtile*this.width-7,this.ytile*this.height),this.getTile(this.xtile+this.length,this.ytile)!==n.OBJECT_WALL&&i!==n.OBJECT_METAL&&i!==n.OBJECT_JAR||this.ctx.drawImage(this.engine.resources.get("frost"),(this.xtile+this.length)*this.width-7,this.ytile*this.height)),this.ctx.restore()}glide(){this.counter+=4,this.counter<=n.TILE_WIDTH?this.x+=4*this.dirrection:this.push()}doDown(){this.counter+=4,this.counter<=n.TILE_WIDTH?this.y+=4:this.gravity()||this.setState(n.MOVE_STAND,!1)}push(t){this.dirrection=void 0===t?this.dirrection:t,this.collision()||this.gravity()?this.setState(n.MOVE_STAND,!1):this.setState(n.MOVE_ICE_MOVING,!0)}checkUnfreeze(){const t=this.engine.spriteTypeAt(this.xtile-1,this.ytile),i=this.engine.spriteTypeAt(this.xtile+this.length,this.ytile);this.getTile(this.xtile-1,this.ytile)!==n.OBJECT_WALL&&this.getTile(this.xtile+this.length,this.ytile)!==n.OBJECT_WALL&&t!==n.OBJECT_METAL&&t!==n.OBJECT_JAR&&i!==n.OBJECT_METAL&&i!==n.OBJECT_JAR&&(this.frozen=!1)}checkFreeze(){const t=this.engine.spriteTypeAt(this.xtile-1,this.ytile),i=this.engine.spriteTypeAt(this.xtile+this.length,this.ytile);this.getTile(this.xtile-1,this.ytile)===n.OBJECT_WALL||this.getTile(this.xtile+this.length,this.ytile)===n.OBJECT_WALL||t===n.OBJECT_METAL||t===n.OBJECT_JAR||i===n.OBJECT_METAL||i===n.OBJECT_JAR?this.frozen=!0:this.frozen=!1}}class T extends l{constructor(t,i,e){super(n.OBJECT_FIRE,t,"img_fire",i,e,n.TILE_WIDTH,n.TILE_WIDTH,0,0,0,3,!0)}move(){switch(this.moving||(this.collisions(),this.gravity()),this.state){case n.MOVE_DOWN:this.doDown()}}collisions(){this.engine.spriteTypeAt(this.xtile,this.ytile,n.OBJECT_FIRE)===n.OBJECT_ICE&&(this.engine.sound.play("fire-off"),this.engine.removeFire(this.xtile,this.ytile),this.engine.removeIceBlock(this.xtile,this.ytile),this.engine.addSparks(this.xtile,this.ytile,"255, 126, 198",15,.5),this.engine.addSparks(this.xtile,this.ytile,"124, 212, 255",10)),this.engine.spriteTypeAt(this.xtile,this.ytile,n.OBJECT_FIRE)===n.OBJECT_METAL&&(this.engine.sound.play("fire-off"),this.engine.removeFire(this.xtile,this.ytile),this.engine.addSparks(this.xtile,this.ytile,"255, 126, 198",15,.5))}gravity(){return!this.coorners.d&&(this.setState(n.MOVE_DOWN,!0),!0)}doDown(){this.counter+=4,this.counter<=n.TILE_WIDTH?this.y+=4:this.setState(n.MOVE_STAND,!1)}}const E=[{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:0,sprites:[{id:7,x:11,y:4,v:1},{id:3,x:5,y:9,v:1},{id:3,x:5,y:8,v:1},{id:3,x:5,y:7,v:1},{id:3,x:5,y:6,v:1},{id:6,x:6,y:4,v:1},{id:3,x:8,y:4,v:1},{id:6,x:7,y:9,v:1},{id:6,x:7,y:8,v:1},{id:6,x:7,y:7,v:1},{id:6,x:9,y:10,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:1,sprites:[{id:7,x:3,y:7,v:1},{id:6,x:6,y:7,v:1},{id:3,x:4,y:7,v:1},{id:3,x:10,y:5,v:4},{id:6,x:12,y:8,v:1},{id:6,x:12,y:7,v:1},{id:6,x:12,y:6,v:1},{id:6,x:13,y:8,v:1},{id:3,x:11,y:8,v:1},{id:3,x:11,y:7,v:1},{id:3,x:11,y:6,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:2,sprites:[{id:7,x:14,y:6,v:1},{id:6,x:10,y:9,v:1},{id:3,x:5,y:4,v:1},{id:6,x:9,y:6,v:1},{id:6,x:9,y:5,v:1},{id:3,x:11,y:6,v:1},{id:3,x:11,y:5,v:1},{id:3,x:8,y:6,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:0,sprites:[{id:7,x:8,y:9,v:1},{id:6,x:12,y:8,v:1},{id:6,x:13,y:7,v:1},{id:6,x:11,y:9,v:1},{id:3,x:6,y:8,v:5},{id:3,x:10,y:9,v:1},{id:3,x:10,y:7,v:3},{id:3,x:12,y:6,v:2},{id:3,x:6,y:9,v:1},{id:3,x:4,y:7,v:3},{id:3,x:3,y:6,v:2},{id:6,x:5,y:9,v:1},{id:6,x:4,y:8,v:1},{id:6,x:3,y:7,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,0,1,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,0,1,1,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,0,1,1,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1],[1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1],[1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:6,sprites:[{id:7,x:11,y:8,v:1},{id:3,x:10,y:10,v:3},{id:3,x:10,y:9,v:3},{id:3,x:7,y:7,v:1},{id:3,x:3,y:5,v:1},{id:3,x:9,y:7,v:1},{id:6,x:3,y:10,v:1},{id:3,x:3,y:4,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:5,sprites:[{id:7,x:14,y:3,v:1},{id:3,x:14,y:4,v:1},{id:3,x:3,y:4,v:1},{id:3,x:6,y:6,v:1},{id:3,x:8,y:6,v:1},{id:3,x:10,y:6,v:1},{id:3,x:1,y:8,v:12},{id:6,x:2,y:10,v:1},{id:6,x:3,y:10,v:1},{id:6,x:5,y:10,v:1},{id:6,x:4,y:10,v:1},{id:6,x:6,y:10,v:1},{id:6,x:7,y:10,v:1},{id:6,x:8,y:10,v:1},{id:6,x:9,y:10,v:1},{id:6,x:11,y:10,v:1},{id:6,x:12,y:10,v:1},{id:6,x:10,y:10,v:1},{id:6,x:2,y:7,v:1},{id:3,x:2,y:5,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:1,sprites:[{id:7,x:12,y:4,v:1},{id:6,x:8,y:11,v:1},{id:6,x:8,y:10,v:1},{id:6,x:9,y:11,v:1},{id:6,x:10,y:11,v:1},{id:3,x:8,y:5,v:5},{id:3,x:10,y:4,v:1},{id:3,x:6,y:6,v:1},{id:6,x:6,y:5,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:1,sprites:[{id:7,x:8,y:6,v:1},{id:6,x:5,y:10,v:1},{id:6,x:6,y:10,v:1},{id:6,x:7,y:10,v:1},{id:6,x:8,y:10,v:1},{id:6,x:9,y:10,v:1},{id:6,x:10,y:10,v:1},{id:3,x:11,y:10,v:2},{id:3,x:5,y:9,v:7},{id:6,x:5,y:8,v:1},{id:3,x:11,y:6,v:1},{id:6,x:11,y:5,v:1},{id:3,x:6,y:5,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:6,sprites:[{id:7,x:5,y:4,v:1},{id:6,x:5,y:8,v:1},{id:3,x:8,y:5,v:1},{id:3,x:8,y:4,v:1},{id:6,x:11,y:8,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1],[1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:10,sprites:[{id:7,x:3,y:4,v:1},{id:6,x:2,y:6,v:1},{id:6,x:3,y:7,v:1},{id:6,x:4,y:8,v:1},{id:6,x:5,y:9,v:1},{id:6,x:6,y:10,v:1},{id:6,x:7,y:10,v:1},{id:6,x:8,y:9,v:1},{id:6,x:9,y:8,v:1},{id:6,x:10,y:7,v:1},{id:6,x:11,y:6,v:1},{id:3,x:2,y:5,v:10},{id:3,x:5,y:4,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,1,0,1,1,1],[1,1,1,0,0,0,0,0,0,1,0,0,1,0,1,1,1],[1,1,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1],[1,1,1,1,1,0,0,0,1,1,0,0,1,0,1,1,1],[1,1,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:6,sprites:[{id:7,x:3,y:3,v:1},{id:6,x:13,y:10,v:1},{id:6,x:5,y:10,v:1},{id:6,x:6,y:10,v:1},{id:6,x:7,y:10,v:1},{id:3,x:4,y:4,v:1},{id:3,x:6,y:3,v:2},{id:3,x:11,y:3,v:2},{id:6,x:9,y:3,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:7,sprites:[{id:7,x:8,y:5,v:1},{id:6,x:6,y:5,v:1},{id:3,x:10,y:5,v:1},{id:3,x:2,y:3,v:2},{id:3,x:14,y:4,v:1},{id:3,x:14,y:4,v:1},{id:3,x:13,y:3,v:1},{id:6,x:14,y:3,v:1},{id:6,x:11,y:10,v:1},{id:6,x:5,y:10,v:1},{id:6,x:12,y:9,v:1},{id:6,x:2,y:9,v:1},{id:6,x:6,y:9,v:1},{id:6,x:7,y:9,v:1},{id:6,x:8,y:9,v:1},{id:6,x:9,y:9,v:1},{id:6,x:10,y:9,v:1},{id:6,x:13,y:9,v:1},{id:3,x:3,y:9,v:1},{id:3,x:3,y:8,v:11},{id:6,x:4,y:9,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1],[1,1,0,1,0,0,0,0,0,0,0,1,1,1,0,1,1],[1,1,0,1,1,0,0,0,0,0,1,1,1,1,0,1,1],[1,1,0,1,1,1,0,0,0,0,1,1,1,1,0,1,1],[1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],sprites:[{id:7,x:13,y:2,v:1},{id:3,x:4,y:4,v:8},{id:3,x:11,y:3,v:4},{id:6,x:3,y:5,v:1},{id:6,x:4,y:6,v:1},{id:6,x:5,y:7,v:1},{id:6,x:10,y:6,v:1},{id:6,x:11,y:5,v:1},{id:6,x:14,y:10,v:1},{id:6,x:14,y:9,v:1},{id:6,x:2,y:10,v:1},{id:6,x:9,y:8,v:1},{id:6,x:2,y:9,v:1},{id:6,x:8,y:8,v:1},{id:6,x:7,y:8,v:1},{id:6,x:6,y:8,v:1},{id:6,x:8,y:10,v:1},{id:6,x:7,y:10,v:1}],theme:8},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:6,sprites:[{id:7,x:14,y:10,v:1}]},{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,1,1,1,1,0,0,1,0,1,1,0,0,1,1],[1,1,0,1,0,0,1,1,0,1,0,1,0,1,0,1,1],[1,1,0,1,1,0,1,1,1,1,0,1,0,1,0,1,1],[1,1,0,1,0,0,1,0,1,1,0,1,0,1,0,1,1],[1,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,1],[1,1,0,1,1,0,1,0,0,1,1,1,1,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],theme:9,sprites:[{id:7,x:10,y:11,v:1},{id:6,x:8,y:1,v:1},{id:5,x:4,y:11,v:1},{id:6,x:8,y:5,v:1}]}];class I{constructor(t){this.engine=t}save(){let t={};t.map=this.engine.map.map,t.theme=this.engine.map.theme,t.sprites=[];for(const i of this.engine.sprites){let e=void 0===i.length?1:i.length;e=i.id===n.OBJECT_JAR?i.onFire:e,t.sprites.push({id:i.id,x:i.xtile,y:i.ytile,v:e})}return t}load(t){void 0===E[t]&&(t=0),this.engine.level=t;const i=E[t];this.engine.sprites=[],this.engine.map=new r(this.engine,i.map,i.theme);for(const t of i.sprites)switch(t.id){case n.OBJECT_PLAYER:this.engine.player=new _(this.engine,t.x,t.y),this.engine.addSprite(this.engine.player);break;case n.OBJECT_ICE:t.v=void 0===t.v?1:t.v,this.engine.addSprite(new c(this.engine,t.x,t.y,parseInt(t.v)));break;case n.OBJECT_METAL:this.engine.addSprite(new Metal(this.engine,t.x,t.y,1));break;case n.OBJECT_FIRE:this.engine.addSprite(new T(this.engine,t.x,t.y));break;case n.OBJECT_JAR:const i=new Jar(this.engine,t.x,t.y);i.onFire="1"===t.v,this.engine.addSprite(i)}}}class y{constructor(t,i,e,s,h){this.color=void 0===s?"255,255,255":s,this.r=3,this.x=i,this.y=e,this.vx=(4*Math.random()-2)*h,this.vy=(6*Math.random()-4)*h,this.speed=.15,this.life=255,this.ctx=t}draw(){let t=this.life/255;this.ctx.beginPath(),this.ctx.fillStyle="rgba("+this.color+","+t+")",this.ctx.arc(this.x,this.y,this.r,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()}move(){this.x+=this.vx,this.y+=this.vy,this.vy+=this.speed,this.life-=5}}class A extends d{constructor(t,i,e,s,h,r){super(null,t,i,e,32,32),this.color=void 0===s?"255,255,255":s,this.length=void 0===h?10:h,this.intencity=void 0===r?1:r,this.particles=[];for(let t=0;t<this.length;t++)this.particles[t]=new y(this.engine.ctx,i*n.TILE_WIDTH+16,e*n.TILE_WIDTH+16,this.color,this.intencity)}draw(){this.engine.ctx.save();for(let t=0;t<this.particles.length;t++)this.particles[t].draw();this.engine.ctx.restore()}engineMove(){this.move()}move(){for(let t=0;t<this.particles.length;t++)this.particles[t].move(),this.particles[t].life<0&&this.particles.splice(t,1);this.particles.length||this.engine.removeSfx(this)}}class x{constructor(t,i){this.canvas=t,this.cwidth=t.width,this.cheight=t.height,this.resources=i,this.ctx=this.canvas.getContext("2d"),this.state=n.GAME_STATE_INTRO,this.sprites=[],this.sfxs=[],this.player={},this.level=0,this.keyboard=new s,this.sound=new h,this.scene=new I(this),this.editor=!1,this.noSpriteMoveCount=0;const e=localStorage.getItem("level");null!==e&&(this.level=parseInt(e,10)),this.scene.load(this.level)}draw(){this.ctx.clearRect(0,0,this.cwidth,this.cheight),this.map.draw();for(let t=this.sprites.length-1;t>=0;t--)this.sprites[t].draw();for(let t=0;t<this.sfxs.length;++t)this.sfxs[t].draw()}collision(){this.sprites.filter(t=>t.id===n.OBJECT_FIRE).length||this.editor||this.player.state===MOVE_OUTRO||this.player.outro()}nextLevel(){this.level++,localStorage.setItem("level",this.level),this.scene.load(this.level)}move(){for(let t=0;t<this.sprites.length;++t)this.sprites[t].engineMove();for(let t=0;t<this.sfxs.length;++t)this.sfxs[t].engineMove();let t=!1;for(let i=0;i<this.sprites.length;++i)this.sprites[i]&&this.sprites[i].id!==n.OBJECT_PLAYER&&this.sprites[i].moving&&(t=!0);t?this.noSpriteMoveCount=0:this.noSpriteMoveCount+=1,!t&&this.noSpriteMoveCount>1&&(this.noSpriteMoveCount=0,this.keyboard.up,(this.keyboard.down||this.keyboard.action)&&this.player.ice(),this.keyboard.left&&this.player.left(),this.keyboard.right&&this.player.right(),this.keyboard.enter&&(this.sound.stop("danger"),this.scene.load(this.level),this.keyboard.enter=!1)),this.collision()}iceAt(t,i){for(let e=0;e<this.sprites.length;e++)if(this.sprites[e].isSpriteAt(t,i))return this.sprites[e];return!1}addIceBlock(t,i,e){let s=[];e="undefined"!=typeof length&&e;for(let e=0;e<this.sprites.length;e++)if(this.sprites[e].id===n.OBJECT_ICE&&this.sprites[e].ytile===i){let i=this.sprites[e];i.xtile-1!==t&&i.xtile+i.length!==t||s.push(i)}0===s.length?this.sprites.push(new c(this,t,i,1,e)):1===s.length?s[0].addBlock(t):this.joinIceBlocks(s[0],s[1])}joinIceBlocks(t,i){let e=t.xtile<=i.xtile?t.xtile:i.xtile,s=t.ytile,h=t.length+i.length+1;this.addSprite(new c(this,e,s,h)),this.removeSprite(t),this.removeSprite(i)}removeIceBlock(t,i){for(let e=0;e<this.sprites.length;e++)if(this.sprites[e].id===n.OBJECT_ICE&&this.sprites[e].ytile===i&&t>=this.sprites[e].xtile&&t<this.sprites[e].xtile+this.sprites[e].length)return void(this.sprites[e].removeBlock(t)<=0&&this.sprites.splice(e,1))}removeFire(t,i){for(let e=0;e<this.sprites.length;e++)if(this.sprites[e].ytile===i&&t===this.sprites[e].xtile&&this.sprites[e].id===n.OBJECT_FIRE)return void this.sprites.splice(e,1)}addSprite(t){this.sprites.push(t)}removeSprite(t){for(let i=0;i<this.sprites.length;i++)if(this.sprites[i]===t)return this.sprites.splice(i,1),!0;return!1}addSparks(t,i,e,s,h){this.sfxs.push(new A(this,t,i,e,s,h))}removeSfx(t){for(let i=0;i<this.sfxs.length;i++)if(this.sfxs[i]===t)return this.sfxs.splice(i,1),!0;return!1}spriteTypeAt(t,i,e){if(e=void 0===e?n.OBJECT_OUT:e,t<0||i<0||t>this.map.width||i>this.map.height)return n.OBJECT_OUT;if(this.map.map[i][t])return this.map.map[i][t];for(let s=0;s<this.sprites.length;s++)if(this.sprites[s].isSpriteAt(t,i)&&this.sprites[s].id!==e)return this.sprites[s].id;return n.OBJECT_BACKGROUND}spriteAt(t,i){if(!this.map.map[i][t])for(let e=0;e<this.sprites.length;e++)if(this.sprites[e].isSpriteAt(t,i))return this.sprites[e];return null}}class g{constructor(t,i){this.state=n.GAME_STATE_INTRO,this.engine=new x(t,i),this.createIntro(),this.gameloop=this.gameloop_.bind(this),this.gameloop()}gameloop_(){switch(this.state){case n.GAME_STATE_INTRO:this.doIntro();break;case n.GAME_STATE_PLAY:this.engine.draw(),this.engine.move()}window.requestAnimationFrame(this.gameloop)}createIntro(){this.intro=new l(null,this.engine,"img_intro",0,0,544,416,0,0,0,0,!1),this.start=new l(null,this.engine,"img_start",7,11,140,26,-10,0,0,1,!0),this.start.animDelay=20*n.ANIM_STANDARD_DELAY}doIntro(){this.intro.draw(),this.start.draw(),this.engine.keyboard.enter&&(this.state=n.GAME_STATE_PLAY,this.engine.sound.soundrack())}}class m{constructor(){this.resources={}}add(t,i){this.resources[t]=i}get(t){return this.resources[t]}}window.addEventListener("load",()=>{const t=new m;t.add("tilemap",document.getElementById("img_tilemap")),t.add("img_ice",document.getElementById("img_ice")),t.add("img_jar",document.getElementById("img_jar")),t.add("img_fire",document.getElementById("img_fire")),t.add("img_dona",document.getElementById("img_dona")),t.add("img_intro",document.getElementById("img_intro")),t.add("img_start",document.getElementById("img_start")),t.add("img_metal",document.getElementById("img_metal")),t.add("frost",document.getElementById("img_frozen"));const i=document.getElementById("canvas"),e=new g(i,t);window.game=e,document.getElementById("level-selector").addEventListener("change",t=>{"-1"!==t.target.value&&(e.engine.level=parseInt(t.target.value,10),e.engine.scene.load(e.engine.level),t.target.blur())})})}]);